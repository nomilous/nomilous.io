// Generated by CoffeeScript 1.6.3
module.exports = function() {
  /* browser-side*/

  var Promise, THREE, aspect, camera, container, dom, far, fov, height, near, renderer, scene, width, xhr;
  dom = require('dom');
  THREE = require('three');
  xhr = require('xhr');
  Promise = require('promise');
  container = dom('body').append('<div></div>');
  width = 400;
  height = 300;
  fov = 45;
  aspect = width / height;
  near = 0.1;
  far = 1000;
  renderer = new THREE.WebGLRenderer;
  camera = new THREE.PerspectiveCamera(fov, aspect, near, far);
  scene = new THREE.Scene;
  scene.add(camera);
  camera.position.z = 300;
  renderer.setSize(width, height);
  renderer.setClearColor(0x222222, 1);
  container.append(renderer.domElement);
  return Promise.all(['/earth', '/visitors'].map(function(path) {
    return new Promise(function(resolve, reject) {
      return xhr({
        method: 'GET',
        url: path
      }, function(_arg) {
        var response, status;
        status = _arg.status, response = _arg.response;
        if (status === 200) {
          return resolve(JSON.parse(response));
        }
        return reject(new Error("" + path + " error status", status));
      }, reject);
    });
  })).then(function(_arg) {
    var animate, earth, visitors;
    earth = _arg[0], visitors = _arg[1];
    animate = function() {
      try {
        requestAnimationFrame(animate);
      } catch (_error) {}
      return renderer.render(scene, camera);
    };
    return animate();
  }, function(error) {
    return console.log(error);
  });
};
